---
title: ""
format: html
execute: 
  echo: false
---

```{r}
suppressPackageStartupMessages(library(tidyverse))
suppressPackageStartupMessages(library(tidymodels))
library(marginaleffects)
library(dplyr)
library(gt)
library(ggplot2)
library(scales)
library(patchwork)
library(stringr)
```

```{r}
x <- readRDS("data/x.rds")

#clean data
x <- x |> filter(!is.na(accessinet), !is.na(agep), !is.na(rac1p), !is.na(schl), !is.na(esr), !is.na(hincp), hincp > 0, hincp < 1e6)

x<- x|>
  mutate(accessinet_binary = case_when(
    accessinet == 1 ~ 1,
    accessinet %in% c(2, 3) ~ 0,
    TRUE ~ NA_real_  
  ))

x <- x |>
  mutate(accessinet_binary = factor(accessinet_binary, levels = c(0, 1), labels = c("LimitedOrNoAccess", "FullAccess")))
```

```{r}
model<-logistic_reg()|>fit(accessinet_binary~agep+hincp+agep*hincp, data=x)
model|>tidy(conf.int=TRUE)->model_tidy
```

```{r}
#turns model_tidy tibble into a more presentable table
model_tidy |> 
  mutate(
    term = case_when(
      term == "(Intercept)" ~ "Intercept",
      term == "agep" ~ "Age (agep)",
      term == "hincp" ~ "Household Income (hincp)",
      term == "agep:hincp" ~ "Age Ã— Income"
    ),
    estimate = round(estimate, 8),
    std.error = round(std.error, 8),
    conf.low = round(conf.low, 8),
    conf.high = round(conf.high, 8)
  ) |> 
  select(term, estimate, std.error, conf.low, conf.high) |> 
  gt() |> 
  cols_label(
    term = "Term",
    estimate = "Estimate",
    std.error = "Std. Error",
    conf.low = "95% CI (Low)",
    conf.high = "95% CI (High)"
  ) |> 
  tab_header(
    title = "Model Results"
  )
```




This table highlights key results from the model. It is important to note that the Intercept value should be disregarded as this indicates the log odds of  someone for whom both the predictors (age and household income) equal zero having full internet access. Considering that none of the confidence intervals include 0, these predictions appear reasonable. Most notably these estimates indicate that an increase one year in age decreases the log-odds of full internet access by roughly 3% and a one dollar increase in household income leads to a small increase in the log odds of full internet access.  




$$
\log\left(\frac{P(\text{accessinet\_binary} = 1)}{1 - P(\text{accessinet\_binary} = 1)}\right)
= \beta_0 + \beta_1 \cdot \text{agep} + \beta_2 \cdot \text{hincp} + \beta_3 \cdot (\text{agep} \times \text{hincp})
$$

$$
\log\left(\frac{P(\text{accessinet\_binary} = 1)}{1 - P(\text{accessinet\_binary} = 1)}\right)
= 3.04 - 0.0339 \cdot \text{agep} + 0.00000704 \cdot \text{hincp} + 0.000000130 \cdot (\text{agep} \times \text{hincp})
$$




These equations reflect the mathematical structure of the model. In both equations predictors agep (age) and hincp (household income) are located on the righthand side of the equation. The righthand side reflects the log odds of the outcome variable (accessinet_binary, representing internet access) equaling one, which indicates full internet access. The bottom equation includes the model's estimated coefficients, showing how the model would compute the log-odds of any person having full internet access based on age and household income. 
